<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>MedMate ‚Äî –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –∞–∫–∫—Ä–µ–¥–∏—Ç–∞—Ü–∏–∏</title>

<!-- ====== –°—Ç–∏–ª–∏: —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π, –Ω–∞—Å—ã—â–µ–Ω–Ω—ã–π, –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π ====== -->
<style>
:root{
  --bg1:#0f172a10; --card:#ffffff; --accent1:#5eead4; --accent2:#60a5fa;
  --accent:#2563eb; --accent-2:#06b6d4; --good:#10b981; --bad:#ef4444;
  --muted:#6b7280; --glass: rgba(255,255,255,0.6);
  --shadow: 0 12px 30px rgba(2,6,23,0.08);
  --radius:14px;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Inter, "Segoe UI", Roboto, Arial;background:linear-gradient(180deg,#eaf2ff 0%, #ffffff 50%);color:#0f172a}
.container{max-width:1100px;margin:18px auto;padding:18px}
.header{display:flex;align-items:center;justify-content:space-between;gap:12px}
.brand{display:flex;gap:12px;align-items:center}
.logo{
  width:64px;height:64px;border-radius:14px;background:linear-gradient(135deg,var(--accent2),var(--accent));
  display:flex;align-items:center;justify-content:center;color:white;font-weight:700;font-size:20px;box-shadow:var(--shadow)
}
.title{line-height:1}
.title h1{margin:0;font-size:20px}
.title p{margin:2px 0 0;color:var(--muted);font-size:13px}

/* Top controls */
.controls{display:flex;gap:10px;align-items:center}
.xp{background:linear-gradient(90deg,#d9f99d,#86efac);padding:8px 12px;border-radius:999px;font-weight:700}
.level{background:linear-gradient(90deg,#bfdbfe,#60a5fa);padding:8px 12px;border-radius:999px;font-weight:700;color:white}
.streak{background:linear-gradient(90deg,#fde68a,#fca5a5);padding:8px 12px;border-radius:999px;font-weight:700}

/* main layout */
.grid{display:grid;grid-template-columns:260px 1fr;gap:16px;margin-top:18px}
.sidebar{position:sticky;top:18px;background:var(--card);padding:14px;border-radius:var(--radius);box-shadow:var(--shadow)}
.nav{display:flex;flex-direction:column;gap:8px}
.tab{padding:10px;border-radius:10px;cursor:pointer;border:1px solid rgba(2,6,23,0.04);display:flex;align-items:center;gap:10px}
.tab.active{background:linear-gradient(90deg,#eff6ff,#fff);border:1px solid rgba(37,99,235,0.12);box-shadow:0 10px 30px rgba(59,130,246,0.08)}
.badge{margin-left:auto;background:#eef2ff;color:var(--accent);padding:6px 8px;border-radius:999px;font-weight:700;font-size:12px}

/* main area */
.main{min-height:520px}
.hero{padding:18px;border-radius:14px;background:linear-gradient(180deg,#ffffff,#f8fafc);box-shadow:var(--shadow);display:flex;gap:18px;align-items:center}
.hero .left{flex:1}
.hero .right{width:240px;text-align:center}
.hero h2{margin:0;font-size:18px}
.hero p{margin:6px 0 0;color:var(--muted)}

.cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px;margin-top:14px}
.card{background:var(--card);padding:14px;border-radius:12px;box-shadow:var(--shadow);border:1px solid rgba(2,6,23,0.03)}
.card h3{margin:0 0 8px}
.small{color:var(--muted);font-size:13px}

/* theory UI */
.question{font-weight:800;margin-bottom:12px;font-size:18px}
.options{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
.option{background:linear-gradient(180deg,#fff,#fbfdff);padding:12px;border-radius:10px;border:1px solid rgba(2,6,23,0.04);cursor:pointer;transition:transform .12s ease,box-shadow .12s}
.option:hover{transform:translateY(-6px);box-shadow:0 12px 30px rgba(2,6,23,0.06)}
.option.correct{border-color:rgba(16,185,129,0.2);box-shadow:0 12px 30px rgba(16,185,129,0.06)}
.option.wrong{border-color:rgba(239,68,68,0.12);box-shadow:0 12px 30px rgba(239,68,68,0.06)}

/* practice station format */
.station{
  display:grid;grid-template-columns:1fr 360px;gap:12px;align-items:start
}
.station-left{padding:12px}
.station-right{padding:12px;border-radius:10px;background:linear-gradient(180deg,#fff,#fbfdff);border:1px solid rgba(2,6,23,0.03)}
.steps{list-style:none;padding:0;margin:0}
.steps li{display:flex;align-items:center;gap:10px;padding:10px;border-radius:10px;margin-bottom:8px;background:white;border:1px solid rgba(2,6,23,0.03)}
.steps li.done{background:linear-gradient(90deg,#ecfdf5,#f0fff4);border-color:rgba(16,185,129,0.12)}
.video-placeholder{height:200px;background:linear-gradient(180deg,#eef2ff,#ffffff);border-radius:10px;display:flex;align-items:center;justify-content:center;border:1px dashed rgba(59,130,246,0.12);color:var(--muted)}

/* cases */
.case-step{padding:12px;border-radius:10px;margin-bottom:10px;background:white;border:1px solid rgba(2,6,23,0.03)}
.case-opts{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}

/* footer & misc */
.footer{margin-top:18px;text-align:center;color:var(--muted);font-size:13px}
.center{display:flex;align-items:center;justify-content:center}
.progress{height:12px;background:#f1f5f9;border-radius:999px;overflow:hidden}
.progress > i{display:block;height:100%;width:0%;background:linear-gradient(90deg,#34d399,#60a5fa);transition:width .5s ease}

/* responsive */
@media (max-width:980px){.grid{grid-template-columns:1fr}.station{grid-template-columns:1fr}.hero .right{display:none}}
</style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="brand">
        <div class="logo">MM</div>
        <div class="title">
          <h1>MedMate ‚Äî –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –∞–∫–∫—Ä–µ–¥–∏—Ç–∞—Ü–∏–∏</h1>
          <p class="small">–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è, —Å—Ç–∞–Ω—Ü–∏–∏ –∏ –∫–µ–π—Å—ã ‚Äî –≤—Å—ë –≥–æ—Ç–æ–≤–æ –∫ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏</p>
        </div>
      </div>

      <div class="controls">
        <div class="xp" id="xpBadge">XP: 0</div>
        <div class="level" id="levelBadge">Lvl 1</div>
        <div class="streak" id="streakBadge">Streak: 0</div>
      </div>
    </div>

    <div class="grid">
      <!-- SIDEBAR -->
      <aside class="sidebar">
        <div style="display:flex;gap:10px;align-items:center;margin-bottom:12px">
          <div style="flex:1">
            <div class="small">–í—ã–±—Ä–∞–Ω –∫—É—Ä—Å</div>
            <div style="font-weight:800" id="chosenCourse">‚Äî</div>
          </div>
          <div>
            <button class="tab" onclick="openCourseChooser()">–°–º–µ–Ω–∏—Ç—å</button>
          </div>
        </div>

        <nav class="nav">
          <div class="tab active" data-tab="home" onclick="switchTab('home')">üè† –ì–ª–∞–≤–Ω–æ–µ <span class="badge">NEW</span></div>
          <div class="tab" data-tab="theory" onclick="switchTab('theory')">üß† –¢–µ–æ—Ä–∏—è</div>
          <div class="tab" data-tab="practice" onclick="switchTab('practice')">üíâ –ü—Ä–∞–∫—Ç–∏–∫–∞</div>
          <div class="tab" data-tab="cases" onclick="switchTab('cases')">üìù –ö–µ–π—Å—ã</div>
          <div class="tab" data-tab="profile" onclick="switchTab('profile')">üë§ –ü—Ä–æ—Ñ–∏–ª—å</div>
        </nav>

        <div style="margin-top:12px" class="small">
          <div style="margin-bottom:6px">–ü—Ä–æ–≥—Ä–µ—Å—Å –∫—É—Ä—Å–∞</div>
          <div class="progress"><i id="globalProgress" style="width:0%"></i></div>
        </div>

        <div style="margin-top:12px" class="small">
          <div style="font-weight:700;margin-bottom:6px">–ë–µ–π–¥–∂–∏</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <div class="badge" id="badgeFirst">1st</div>
            <div class="badge" id="badgeStreak">Streak</div>
            <div class="badge" id="badgePractice">Practice</div>
          </div>
        </div>
      </aside>

      <!-- MAIN -->
      <main class="main" id="mainArea">
        <!-- HERO / HOME -->
        <section id="tab-home" class="card">
          <div class="hero">
            <div class="left">
              <h2 id="welcomeTitle">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ MedMate</h2>
              <p class="small">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∫—É—Ä—Å, –∑–∞—Ç–µ–º –ø—Ä–æ—Ö–æ–¥–∏—Ç–µ –º–æ–¥—É–ª–∏: —Ç–µ–æ—Ä–∏—è, –ø—Ä–∞–∫—Ç–∏–∫–∞ –∏ –∫–µ–π—Å—ã. –í—Å—ë —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –∏ –º–æ–∂–Ω–æ –≤ –±—É–¥—É—â–µ–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å —Å–µ—Ä–≤–µ—Ä–æ–º.</p>

              <div style="margin-top:12px;display:flex;gap:8px">
                <button class="btn" style="padding:10px 14px;border-radius:10px;background:linear-gradient(90deg,var(--accent-2),var(--accent)) ;color:white" onclick="openCourseChooser()">–í—ã–±—Ä–∞—Ç—å –∫—É—Ä—Å</button>
                <button class="btn ghost" style="background:transparent;border:1px solid rgba(37,99,235,0.08);" onclick="switchTab('theory')">–ü–µ—Ä–µ–π—Ç–∏ –≤ —Ç–µ–æ—Ä–∏—é</button>
              </div>
            </div>
            <div class="right">
              <div style="background:linear-gradient(180deg,#fff,#f8fafc);padding:12px;border-radius:10px;box-shadow:var(--shadow)">
                <div style="font-weight:800">–¢–≤–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å</div>
                <div style="margin-top:8px" class="small">–û—á–∫–∏ –∏ –±–µ–π–¥–∂–∏ ‚Äî –º–æ—Ç–∏–≤–∞—Ü–∏—è –¥–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–π –ø—Ä–∞–∫—Ç–∏–∫–∏</div>
                <div style="margin-top:12px"><div class="small">–û—á–∫–∏: <span id="points">0</span></div>
                <div style="margin-top:8px"><div class="small">Combo: <span id="combo">0</span></div></div></div>
              </div>
            </div>
          </div>

          <div class="cards">
            <div class="card">
              <h3>–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç</h3>
              <div class="small">–ü—Ä–æ–π–¥–∏—Ç–µ 3 –≤–æ–ø—Ä–æ—Å–∞ —Ç–µ–æ—Ä–∏–∏ –∏ 1 —Å—Ç–∞–Ω—Ü–∏—é ‚Äî –ø–æ–ª—É—á–∏—Ç–µ –±–æ–Ω—É—Å–Ω—ã–π –±–µ–π–¥–∂ "Starter".</div>
              <div style="margin-top:12px"><button class="btn" onclick="startQuickRun()">–ó–∞–ø—É—Å—Ç–∏—Ç—å Quick Run</button></div>
            </div>

            <div class="card">
              <h3>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h3>
              <div class="small">–°—Ñ–æ–∫—É—Å–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ: —Å—Ç–∞–Ω—Ü–∏–∏ –∏–º–µ—é—Ç —á–µ–∫-–ª–∏—Å—Ç—ã –∏ –≤–∏–¥–µ–æ–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏.</div>
            </div>

            <div class="card">
              <h3>–ö–µ–π—Å—ã</h3>
              <div class="small">–†–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ ‚Äî –≤—ã–±–∏—Ä–∞–π –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –ø–æ–ª—É—á–∞–π –æ—á–∫–∏.</div>
              <div style="margin-top:10px"><button class="btn ghost" onclick="switchTab('cases')">–û—Ç–∫—Ä—ã—Ç—å –∫–µ–π—Å—ã</button></div>
            </div>
          </div>
        </section>

        <!-- THEORY -->
        <section id="tab-theory" class="card hide">
          <div id="theoryArea"></div>
        </section>

        <!-- PRACTICE -->
        <section id="tab-practice" class="card hide">
          <div id="practiceArea"></div>
        </section>

        <!-- CASES -->
        <section id="tab-cases" class="card hide">
          <div id="casesArea"></div>
        </section>

        <!-- PROFILE -->
        <section id="tab-profile" class="card hide">
          <h3>–ü—Ä–æ—Ñ–∏–ª—å</h3>
          <div class="small">–ü–æ–∫–∞ –ø—Ä–æ—Ñ–∏–ª—å –ª–æ–∫–∞–ª—å–Ω—ã–π ‚Äî –≤ –±—É–¥—É—â–µ–º –º–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –∏ —Å–µ—Ä–≤–µ—Ä.</div>
          <div style="margin-top:12px">
            <div class="small">–ò–º—è: <strong id="profileName">Student</strong></div>
            <div class="small" style="margin-top:8px">–û—á–∫–∏: <strong id="profilePoints">0</strong></div>
            <div style="margin-top:12px"><button class="btn ghost" onclick="resetAll()">–°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å</button></div>
          </div>
        </section>

      </main>
    </div>

    <div class="footer">MedMate ‚Äî –ø—Ä–æ—Ç–æ—Ç–∏–ø –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏. –í–∏–¥–µ–æ–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –≤—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –≤ —Ä–∞–∑–¥–µ–ª –ü—Ä–∞–∫—Ç–∏–∫–∏.</div>
  </div>

<!-- ====== Script: –≤—Å—è –ª–æ–≥–∏–∫–∞ (–ª–æ–∫–∞–ª—å–Ω–æ, –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö —Ñ–∞–π–ª–æ–≤) ====== -->
<script>
/* -------------------------
   State + Demo Data
   ------------------------- */
const STORAGE_KEY = 'medmate_v2_state';
let state = {
  course: null,
  points: 0,
  xp: 0,
  level: 1,
  streak: 0,
  combo: 0,
  theoryIndex: 0,
  completedStations: {},
  badges: {}
};
/* demo content: theory / practice / cases (short sample sets) */
const CONTENT = {
  theory: {
    '3': [
      {id:1, topic:'–ö–∞—Ä–¥–∏–æ–ª–æ–≥–∏—è', q:'–ù–æ—Ä–º–∞ –ß–°–° –≤–∑—Ä–æ—Å–ª–æ–≥–æ?', options:['60-100','40-60','100-120','120-140'], a:'60-100', explain:'–ù–æ—Ä–º–∞ 60‚Äì100 —É–¥/–º–∏–Ω. –ú–Ω–µ–º–æ–Ω–∏–∫–∞: ¬´60‚Äì100 ‚Äî –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π —à–∞–≥¬ª.'},
      {id:2, topic:'–§–∏–∑–∏–æ–ª–æ–≥–∏—è', q:'–û—Ä–≥–∞–Ω —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∫—Ä–æ–≤–∏?', options:['–ü–æ—á–∫–∏','–ü–µ—á–µ–Ω—å','–°–µ—Ä–¥—Ü–µ','–õ—ë–≥–∫–∏–µ'], a:'–ü–æ—á–∫–∏', explain:'–ü–æ—á–∫–∏ —É–¥–∞–ª—è—é—Ç –ø—Ä–æ–¥—É–∫—Ç—ã –æ–±–º–µ–Ω–∞.'},
      {id:3, topic:'–ü—É–ª—å–º–æ–Ω–æ–ª–æ–≥–∏—è', q:'–°–ø–∏—Ä–æ–º–µ—Ç—Ä–∏—è –∏–∑–º–µ—Ä—è–µ—Ç?', options:['–§—É–Ω–∫—Ü–∏—é –¥—ã—Ö–∞–Ω–∏—è','–≠–ö–ì','–£–ó–ò','–¢–µ—Ä–º–æ'], a:'–§—É–Ω–∫—Ü–∏—é –¥—ã—Ö–∞–Ω–∏—è', explain:'–°–ø–∏—Ä–æ–º–µ—Ç—Ä–∏—è ‚Äî –æ–±—ä—ë–º/—Å–∫–æ—Ä–æ—Å—Ç—å –¥—ã—Ö–∞–Ω–∏—è.'}
    ],
    '6': [
      {id:1, topic:'–†–µ–∞–Ω–∏–º–∞—Ü–∏—è', q:'–ü—Ä–∏ VF –ø–µ—Ä–≤–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ?', options:['–î–µ—Ñ–∏–±—Ä–∏–ª–ª—è—Ü–∏—è','–ê–Ω—Ç–∏–±–∏–æ—Ç–∏–∫–∏','–†–µ–Ω—Ç–≥–µ–Ω','–£–ó–ò'], a:'–î–µ—Ñ–∏–±—Ä–∏–ª–ª—è—Ü–∏—è', explain:'VF ‚Äî —à–æ–∫ (–¥–µ—Ñ–∏–±—Ä–∏–ª–ª—è—Ü–∏—è) –ø–µ—Ä–≤–∏—á–Ω–æ.'},
      {id:2, topic:'–ö–∞—Ä–¥–∏–æ–ª–æ–≥–∏—è', q:'–ü–µ—Ä–≤–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–∏ –û–ò–ú?', options:['–≠–ö–ì','–†–µ–Ω—Ç–≥–µ–Ω','–£–ó–ò','–ö–¢'], a:'–≠–ö–ì', explain:'–≠–ö–ì ‚Äî –ø–µ—Ä–≤–∏—á–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–∏ –±–æ–ª–∏ –≤ –≥—Ä—É–¥–∏.'},
      {id:3, topic:'–ò–Ω—Ñ–µ–∫—Ü–∏—è', q:'–ü—Ä–∏ —Å–µ–ø—Å–∏—Å–µ –≤–∞–∂–Ω–µ–µ –≤—Å–µ–≥–æ?', options:['–†–∞–Ω–Ω—è—è –∞–Ω—Ç–∏–±–∞–∫—Ç–µ—Ä–∏–∞–ª—å–Ω–∞—è —Ç–µ—Ä–∞–ø–∏—è','–§–∏–∑–∏–æ—Ç–µ—Ä–∞–ø–∏—è','–î–∏–µ—Ç–∞','–ú–∞—Å—Å–∞–∂'], a:'–†–∞–Ω–Ω—è—è –∞–Ω—Ç–∏–±–∞–∫—Ç–µ—Ä–∏–∞–ª—å–Ω–∞—è —Ç–µ—Ä–∞–ø–∏—è', explain:'–†–∞–Ω–Ω—è—è –∞–Ω—Ç–∏–±–∏–æ—Ç–∏–∫–æ—Ç–µ—Ä–∞–ø–∏—è —Å–Ω–∏–∂–∞–µ—Ç —Å–º–µ—Ä—Ç–Ω–æ—Å—Ç—å.'}
    ]
  },

  practice: [
    // station format includes id, title, short desc, steps[], video placeholder (url null)
    {id:'slr', title:'–°—Ç–∞–Ω—Ü–∏—è: –°–õ–†', short:'–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –∏ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É', steps:[
      '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –º–µ—Å—Ç–∞',
      '–û—Ü–µ–Ω–∏—Ç—å —Å–æ–∑–Ω–∞–Ω–∏–µ –∏ –¥—ã—Ö–∞–Ω–∏–µ',
      '–í—ã–∑–≤–∞—Ç—å —Å–∫–æ—Ä—É—é –∏ –ø–æ–∑–≤–∞—Ç—å –¥–µ—Ñ–∏–±—Ä–∏–ª–ª—è—Ç–æ—Ä',
      '–ù–∞—á–∞—Ç—å –∫–æ–º–ø—Ä–µ—Å—Å–∏–∏ 30:2 –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –¥–µ—Ñ–∏–±—Ä–∏–ª–ª—è—Ü–∏—é'
    ], video:null, video_note:'–ó–¥–µ—Å—å –±—É–¥–µ—Ç –∫–æ—Ä–æ—Ç–∫–æ–µ –≤–∏–¥–µ–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –°–õ–† (2‚Äì3 –º–∏–Ω—É—Ç—ã).'},
    {id:'exam', title:'–§–∏–∑–∏–∫–∞–ª—å–Ω–æ–µ –æ–±—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ (—Å–µ—Ä–¥—Ü–µ)', short:'–ê—É—Å–∫—É–ª—å—Ç–∞—Ü–∏—è, –ø–∞–ª—å–ø–∞—Ü–∏—è –∏ –æ—Å–º–æ—Ç—Ä', steps:[
      '–û—Å–º–æ—Ç—Ä–µ—Ç—å –ø–∞—Ü–∏–µ–Ω—Ç–∞',
      '–ü–∞–ª—å–ø–∞—Ü–∏—è –≤–µ—Ä—Ö—É—à–µ—á–Ω–æ–≥–æ —Ç–æ–ª—á–∫–∞',
      '–ê—É—Å–∫—É–ª—å—Ç–∞—Ü–∏—è –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —Ç–æ—á–∫–∞—Ö',
      '–ó–∞–ø–∏—Å–∞—Ç—å –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –ø–∞—Ç–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ —à—É–º—ã'
    ], video:null, video_note:'–ó–∞–≥—Ä—É–∑–∏ —Ç—É—Ç –≤–∏–¥–µ–æ –∞—É—Å–∫—É–ª—å—Ç–∞—Ü–∏–∏ –∏ –ø–æ—è—Å–Ω–µ–Ω–∏–µ –∫ –Ω–æ—Ä–º–∞–º.'}
  ],

  cases: {
    '3': [
      {id:'c1', title:'–ö–µ–π—Å: –ë–æ–ª—å –≤ –≥—Ä—É–¥–∏ (45 –ª–µ—Ç)', steps:[
        {q:'–ü–µ—Ä–≤–æ–µ –æ–±—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ?', opts:['–≠–ö–ì','–†–µ–Ω—Ç–≥–µ–Ω','–ö–¢','–£–ó–ò'], a:['–≠–ö–ì','–õ–∞–±. –∞–Ω–∞–ª–∏–∑—ã'], explain:'–≠–ö–ì –∏ —Ç—Ä–æ–ø–æ–Ω–∏–Ω—ã ‚Äî –ø–µ—Ä–≤–∏—á–Ω—ã–µ.'},
        {q:'–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –¥–∏–∞–≥–Ω–æ–∑ –ø—Ä–∏ –ø–æ–¥—ä—ë–º–µ ST?', opts:['–û–ò–ú','–ü–Ω–µ–≤–º–æ–Ω–∏—è','–ü–∞–Ω–∏–∫–∞'], a:'–û–ò–ú', explain:'–ü–æ–¥—ä—ë–º ST ‚Äî –∏–Ω—Ñ–∞—Ä–∫—Ç.'}
      ]}
    ],
    '6': [
      {id:'c1', title:'–ö–µ–π—Å: –û–¥—ã—à–∫–∞ —É –ø–æ–∂–∏–ª–æ–≥–æ', steps:[
        {q:'–ü–µ—Ä–≤–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ?', opts:['–û—Ü–µ–Ω–∫–∞ SAT/–≥–∞–∑–æ–≤','–†–µ–Ω—Ç–≥–µ–Ω','–ö–¢','–≠–ö–ì'], a:['–û—Ü–µ–Ω–∫–∞ SAT/–≥–∞–∑–æ–≤','–†–µ–Ω—Ç–≥–µ–Ω'], explain:'SAT –∏ —Ä–µ–Ω—Ç–≥–µ–Ω –ø–µ—Ä–≤–∏—á–Ω–æ.'}
      ]}
    ]
  }
};

/* -------------------------
   Helpers: storage + UI updates
   ------------------------- */
function saveState(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); updateUI();}
function loadState(){ try{ const s = JSON.parse(localStorage.getItem(STORAGE_KEY)||'null'); if(s) state = {...state, ...s}; }catch(e){} updateUI(); }
function addPoints(n){ state.points += n; state.xp += n; if(state.xp >= state.level*50){ state.xp = 0; state.level++; } state.combo = (state.combo||0)+1; if(state.combo>2) state.points += 2; saveState(); showToast(`+${n} –æ—á–∫–æ–≤`); }
function resetCombo(){ state.combo = 0; saveState(); }
function showToast(txt){ const t = document.createElement('div'); t.innerText = txt; t.style.position='fixed'; t.style.right='18px'; t.style.bottom='18px'; t.style.background='linear-gradient(90deg,#111827,#111827)'; t.style.color='white'; t.style.padding='10px 14px'; t.style.borderRadius='10px'; t.style.zIndex=9999; document.body.appendChild(t); setTimeout(()=>{t.style.transition='opacity .6s';t.style.opacity='0';setTimeout(()=>t.remove(),600)},1800); }
function showModal(title, html){ const modal = document.createElement('div'); modal.style.position='fixed'; modal.style.left=0; modal.style.top=0; modal.style.width='100%'; modal.style.height='100%'; modal.style.display='flex'; modal.style.alignItems='center'; modal.style.justifyContent='center'; modal.style.background='rgba(2,6,23,0.5)'; modal.style.zIndex=99999; modal.innerHTML = `<div style="width:95%;max-width:760px;background:white;padding:18px;border-radius:12px;box-shadow:var(--shadow)"><h3>${title}</h3><div style="margin-top:8px">${html}</div><div style="margin-top:14px;text-align:right"><button class="btn" onclick="document.body.removeChild(this.closest('div').parentNode)">–ó–∞–∫—Ä—ã—Ç—å</button></div></div>`; document.body.appendChild(modal); }

/* -------------------------
   UI initialization + tabs
   ------------------------- */
function switchTab(tab){
  document.querySelectorAll('.tab').forEach(el=>el.classList.toggle('active', el.dataset.tab===tab));
  document.querySelectorAll('#mainArea > section').forEach(s=>s.classList.add('hide'));
  const el = document.getElementById('tab-'+tab);
  if(el) el.classList.remove('hide');
  if(tab==='theory') renderTheory();
  if(tab==='practice') renderPractice();
  if(tab==='cases') renderCases();
  if(tab==='profile') renderProfile();
}
function updateUI(){
  document.getElementById('chosenCourse').innerText = state.course ? (state.course+' –∫—É—Ä—Å') : '‚Äî';
  document.getElementById('points').innerText = state.points;
  document.getElementById('xpBadge').innerText = `XP: ${state.xp}`;
  document.getElementById('levelBadge').innerText = `Lvl ${state.level}`;
  document.getElementById('streakBadge').innerText = `Streak: ${state.streak}`;
  document.getElementById('profilePoints').innerText = state.points;
  document.getElementById('combo').innerText = state.combo||0;
  // progress percentage (example: based on theoryIndex vs total)
  const total = (state.course ? CONTENT.theory[state.course].length : 1);
  const pct = state.theoryIndex ? Math.round((state.theoryIndex/total)*100) : 0;
  document.getElementById('globalProgress').style.width = pct + '%';
  // badges visual
  document.getElementById('badgeFirst').innerText = state.badges.first ? '‚úì First' : 'First';
  document.getElementById('badgeStreak').innerText = state.badges.streak ? '‚úì Streak' : 'Streak';
  document.getElementById('badgePractice').innerText = state.badges.practice ? '‚úì Practice' : 'Practice';
}

/* -------------------------
   Course chooser (forced on first open)
   ------------------------- */
function openCourseChooser(){
  const html = `<div style="display:flex;gap:12px;flex-wrap:wrap"><div style="flex:1"><h3>–í—ã–±–µ—Ä–∏—Ç–µ –∫—É—Ä—Å</h3><p class="small">–ö—É—Ä—Å –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –Ω–∞–±–æ—Ä –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –∫–µ–π—Å–æ–≤.</p><div style="margin-top:10px"><button class="btn" onclick="setCourse('3')">3-–π –∫—É—Ä—Å</button> <button class="btn" style="margin-left:8px;background:linear-gradient(90deg,#06b6d4,#3b82f6)" onclick="setCourse('6')">6-–π –∫—É—Ä—Å</button></div></div></div>`;
  showModal('–í—ã–±–æ—Ä –∫—É—Ä—Å–∞', html);
}
function setCourse(c){
  // remove modal
  const modal = document.querySelector('body > div[style*="position:fixed"]');
  if(modal) document.body.removeChild(modal);
  state.course = c; state.theoryIndex = 0; state.points = state.points||0; saveState();
  showToast(`–ö—É—Ä—Å ${c} –≤—ã–±—Ä–∞–Ω`);
  updateUI();
  switchTab('theory');
}

/* -------------------------
   Theory: render + interactions
   ------------------------- */
function renderTheory(){
  const area = document.getElementById('theoryArea');
  if(!state.course){ area.innerHTML = `<div class="card"><h3>–í—ã–±–µ—Ä–∏—Ç–µ –∫—É—Ä—Å</h3><div class="small">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∫—É—Ä—Å</div><div style="margin-top:12px"><button class="btn" onclick="openCourseChooser()">–í—ã–±—Ä–∞—Ç—å –∫—É—Ä—Å</button></div></div>`; return; }
  const list = CONTENT.theory[state.course];
  if(state.theoryIndex >= list.length){
    area.innerHTML = `<div class="card center"><h2>üéâ –¢–µ–æ—Ä–∏—è –¥–ª—è –∫—É—Ä—Å–∞ ${state.course} –ø—Ä–æ–π–¥–µ–Ω–∞</h2><p class="small">–û—á–∫–∏: ${state.points}</p><div style="margin-top:12px"><button class="btn" onclick="state.theoryIndex=0;saveState();renderTheory()">–ü—Ä–æ–π—Ç–∏ –∑–∞–Ω–æ–≤–æ</button> <button class="btn ghost" onclick="switchTab('practice')">–ü–µ—Ä–µ–π—Ç–∏ –∫ –ø—Ä–∞–∫—Ç–∏–∫–µ</button></div></div>`;
    return;
  }
  const item = list[state.theoryIndex];
  let html = `<div class="card"><div class="small">–¢–µ–º–∞: ${item.topic}</div><div style="margin-top:12px"><div class="question">${item.q}</div><div class="options">`;
  item.options.forEach(opt=> html += `<div class="option" onclick="answerTheory('${escapeHtml(item.a)}','${escapeHtml(opt)}', this)">${opt}</div>`);
  html += `</div><div style="margin-top:12px"><div class="small">–ü—Ä–æ–≥—Ä–µ—Å—Å: ${state.theoryIndex}/${list.length}</div><div style="margin-top:8px"><button class="btn ghost" onclick="switchTab('home')">üè† –í –º–µ–Ω—é</button></div></div></div></div>`;
  area.innerHTML = html;
}
function answerTheory(correct, choice, el){
  // correct may be array or string
  const list = CONTENT.theory[state.course];
  const item = list[state.theoryIndex];
  const isCorrect = Array.isArray(item.a) ? item.a.includes(choice) : (item.a === choice);
  if(isCorrect){
    el.classList.add('correct');
    addPoints(10);
    state.theoryIndex++;
    saveState();
    setTimeout(()=> renderTheory(), 700);
  } else {
    el.classList.add('wrong');
    resetCombo();
    // show explanation
    showModal('–ù–µ–≤–µ—Ä–Ω–æ', `<div style="font-weight:700">–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: <span style="color:var(--good)">${Array.isArray(item.a)?item.a.join(', '):item.a}</span></div><div class="explain" style="margin-top:8px">${item.explain}</div>`);
    // progress on wrong still moves forward after modal closed? keep index to let user retry - choose to move forward anyway
    state.theoryIndex++;
    saveState();
    setTimeout(()=> renderTheory(), 900);
  }
}

/* -------------------------
   Practice: improved station UI + placeholder for video
   ------------------------- */
function renderPractice(){
  const area = document.getElementById('practiceArea');
  let html = `<div class="card"><h3>–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ç–∞–Ω—Ü–∏–∏</h3><div class="small">–ö–∞–∂–¥–∞—è —Å—Ç–∞–Ω—Ü–∏—è –∏–º–µ–µ—Ç —á–µ–∫-–ª–∏—Å—Ç. –í –±–ª–æ–∫–µ —Å–ø—Ä–∞–≤–∞ ‚Äî –º–µ—Å—Ç–æ –¥–ª—è –≤–∏–¥–µ–æ / –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ (–≤—Å—Ç–∞–≤—å URL –ø–æ–∑–∂–µ).</div></div>`;
  CONTENT.practice.forEach(st=>{
    html += `<div class="card" style="margin-top:12px">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div><h3 style="margin:0">${st.title}</h3><div class="small" style="margin-top:6px">${st.short}</div></div>
        <div><button class="btn" onclick="openStation('${st.id}')">–û—Ç–∫—Ä—ã—Ç—å —Å—Ç–∞–Ω—Ü–∏—é</button></div>
      </div>
    </div>`;
  });
  area.innerHTML = html;
}

function openStation(id){
  const st = CONTENT.practice.find(s=>s.id===id);
  const area = document.getElementById('practiceArea');
  // build left (steps) and right (video placeholder)
  let left = `<div class="station-left"><h3>${st.title}</h3><div class="small" style="margin-bottom:10px">${st.short}</div><ul class="steps">`;
  st.steps.forEach((s,i)=> {
    const done = (state.completedStations[id] || []).includes(i);
    left += `<li id="step-${id}-${i}" class="${done?'done':''}"><div style="font-weight:700">${s}</div><div style="margin-left:auto"><button class="btn" onclick="toggleStep('${id}',${i})">${done?'‚úîÔ∏è':'–û—Ç–º–µ—Ç–∏—Ç—å'}</button></div></li>`;
  });
  left += `</ul><div style="margin-top:10px"><button class="btn ghost" onclick="renderPractice()">‚óÄÔ∏è –ù–∞–∑–∞–¥</button></div></div>`;

  let right = `<div class="station-right">
    <div class="video-placeholder" id="video-${id}">
      <div>
        <div style="font-weight:800">–í–∏–¥–µ–æ / –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è</div>
        <div class="small" style="margin-top:6px">${st.video_note}</div>
        <div style="margin-top:8px"><button class="btn ghost" onclick="editVideo('${id}')">–í—Å—Ç–∞–≤–∏—Ç—å –≤–∏–¥–µ–æ</button></div>
      </div>
    </div>
    <div style="margin-top:12px"><div class="small">–ë–∞–ª–ª—ã –∑–∞ –ø–æ–ª–Ω–æ–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ —Å—Ç–∞–Ω—Ü–∏–∏: <strong>+20</strong></div></div>
  </div>`;

  area.innerHTML = `<div class="card station">${left}${right}</div>`;
}

function toggleStep(stationId, idx){
  state.completedStations[stationId] = state.completedStations[stationId] || [];
  const arr = state.completedStations[stationId];
  if(arr.includes(idx)){
    // already done: remove
    state.completedStations[stationId] = arr.filter(x=>x!==idx);
    document.getElementById(`step-${stationId}-${idx}`).classList.remove('done');
    showToast('–®–∞–≥ —Å–Ω—è—Ç');
  } else {
    arr.push(idx);
    document.getElementById(`step-${stationId}-${idx}`).classList.add('done');
    addPoints(5);
    showToast('+5 –æ—á–∫–æ–≤');
  }
  // if all steps done -> award completion bonus and badge
  const total = CONTENT.practice.find(s=>s.id===stationId).steps.length;
  if(state.completedStations[stationId].length === total && !state.badges[stationId]){
    state.badges[stationId] = true;
    addPoints(20);
    showModal('–°—Ç–∞–Ω—Ü–∏—è –ø—Ä–æ–π–¥–µ–Ω–∞', `<div>–í—ã –ø—Ä–æ—à–ª–∏ <strong>${stationId}</strong> ‚Äî –±–æ–Ω—É—Å +20 –æ—á–∫–æ–≤! –ú–µ—Å—Ç–æ –¥–ª—è –≤–∏–¥–µ–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ —Å–ø—Ä–∞–≤–∞.</div>`);
  }
  saveState();
}

/* allow admin to insert video URL into placeholder (future) */
function editVideo(id){
  const url = prompt('–í—Å—Ç–∞–≤—å URL –≤–∏–¥–µ–æ (mp4 –∏–ª–∏ YouTube embed) –¥–ª—è —ç—Ç–æ–π —Å—Ç–∞–Ω—Ü–∏–∏ (–ø—Ä–∏–º–µ—Ä: https://.../cpr.mp4).');
  if(!url) return;
  // render video element into placeholder
  const ph = document.getElementById(`video-${id}`);
  ph.innerHTML = `<video controls width="100%" style="border-radius:8px"><source src="${url}">Your browser does not support video.</video><div style="margin-top:8px" class="small">–í–∏–¥–µ–æ –≤—Å—Ç–∞–≤–ª–µ–Ω–æ (–ª–æ–∫–∞–ª—å–Ω–æ/—Ö–æ—Å—Ç–∏–Ω–≥).</div>`;
  // optionally save into state to persist
  state.videoLinks = state.videoLinks || {}; state.videoLinks[id] = url; saveState();
  showToast('–í–∏–¥–µ–æ –≤—Å—Ç–∞–≤–ª–µ–Ω–æ');
}

/* -------------------------
   Cases (interactive mini-cases)
   ------------------------- */
function renderCases(){
  const area = document.getElementById('casesArea');
  if(!state.course){ area.innerHTML = `<div class="card"><h3>–í—ã–±–µ—Ä–∏—Ç–µ –∫—É—Ä—Å</h3><div class="small">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∫—É—Ä—Å</div><div style="margin-top:12px"><button class="btn" onclick="openCourseChooser()">–í—ã–±—Ä–∞—Ç—å –∫—É—Ä—Å</button></div></div>`; return; }
  const list = CONTENT.cases[state.course];
  let html = `<div class="card"><h3>–ö–µ–π—Å—ã (–∫—É—Ä—Å ${state.course})</h3><div class="small">–í—ã–±–∏—Ä–∞–π –∫–µ–π—Å –∏ –ø—Ä–æ—Ö–æ–¥–∏ —à–∞–≥–∏, –ø–æ–ª—É—á–∞–π –æ—á–∫–∏ –∑–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è.</div></div>`;
  list.forEach((c,i)=> html += `<div class="card" style="margin-top:12px"><div style="display:flex;justify-content:space-between"><div><strong>${c.title}</strong><div class="small">${c.steps.length} —à–∞–≥(–∞)</div></div><div><button class="btn" onclick="startCase('${state.course}',${i})">–ü—Ä–æ–π—Ç–∏ –∫–µ–π—Å</button></div></div></div>`);
  area.innerHTML = html;
}
function startCase(course, idx){
  state.currentCase = {course, idx, step:0, score:0};
  renderCaseStep();
}
function renderCaseStep(){
  const c = CONTENT.cases[state.currentCase.course][state.currentCase.idx];
  const s = c.steps[state.currentCase.step];
  const area = document.getElementById('casesArea');
  let html = `<div class="card"><h3>${c.title}</h3><div class="case-step"><div style="font-weight:800">${s.q}</div><div class="case-opts">`;
  s.opts.forEach(o=> html += `<button class="option" style="margin-right:8px;margin-top:8px" onclick="answerCase('${escapeHtml(o)}')">${o}</button>`);
  html += `</div></div><div style="margin-top:12px"><button class="btn ghost" onclick="renderCases()">‚óÄÔ∏è –ù–∞–∑–∞–¥</button></div></div>`;
  area.innerHTML = html;
}
function answerCase(choice){
  const c = CONTENT.cases[state.currentCase.course][state.currentCase.idx];
  const s = c.steps[state.currentCase.step];
  const correct = Array.isArray(s.a) ? s.a.includes(choice) : s.a === choice;
  if(correct){
    addPoints(12);
    state.currentCase.score += 12;
    showToast('+12 –æ—á–∫–æ–≤ ‚Äî –≤–µ—Ä–Ω–æ');
  } else {
    resetCombo();
    showModal('–ù–µ–≤–µ—Ä–Ω–æ', `<div>–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: <strong>${Array.isArray(s.a)?s.a.join(', '):s.a}</strong><div class="explain" style="margin-top:10px">${s.explain}</div></div>`);
  }
  state.currentCase.step++;
  if(state.currentCase.step >= c.steps.length){
    showModal('–ö–µ–π—Å –∑–∞–≤–µ—Ä—à—ë–Ω', `–í—ã –∑–∞—Ä–∞–±–æ—Ç–∞–ª–∏ ${state.currentCase.score} –æ—á–∫–æ–≤ –≤ —ç—Ç–æ–º –∫–µ–π—Å–µ.`);
    state.currentCase = null;
    renderCases();
  } else {
    setTimeout(renderCaseStep, 600);
  }
  saveState();
}

/* -------------------------
   Profile + reset
   ------------------------- */
function renderProfile(){
  document.getElementById('profileName').innerText = 'Student';
  document.getElementById('profilePoints').innerText = state.points;
}
function resetAll(){
  if(!confirm('–°–±—Ä–æ—Å–∏—Ç—å –≤–µ—Å—å –ª–æ–∫–∞–ª—å–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å?')) return;
  localStorage.removeItem(STORAGE_KEY);
  location.reload();
}

/* -------------------------
   Quick run: 3 theory + 1 station (demo)
   ------------------------- */
function startQuickRun(){
  if(!state.course){ openCourseChooser(); return; }
  // set theoryIndex to 0 and go to first 3 questions quickly
  state.theoryIndex = 0; saveState();
  showModal('Quick Run', `<div>–ü—Ä–æ–π–¥–∏—Ç–µ 3 –≤–æ–ø—Ä–æ—Å–∞ —Ç–µ–æ—Ä–∏–∏ —Å—Ä–∞–∑—É ‚Äî –ø–æ–ª—É—á–∏—Ç–µ –±–æ–Ω—É—Å.</div><div style="margin-top:12px"><button class="btn" onclick="document.body.removeChild(this.closest('div').parentNode);switchTab('theory')">–ù–∞—á–∞—Ç—å</button></div>`);
}

/* -------------------------
   utils
   ------------------------- */
function escapeHtml(s){ return (''+s).replace(/"/g,'&quot;').replace(/'/g,"&#39;"); }

/* init */
loadState();
// If no course chosen, force chooser after short delay
if(!state.course){ setTimeout(()=>openCourseChooser(), 600); }
switchTab('home');
updateUI();
</script>
</body>
</html>
